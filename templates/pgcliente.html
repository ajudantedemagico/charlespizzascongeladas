<!DOCTYPE html>
<html lang="PT-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/CSS/pedido.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link rel="icon" href="/static/img/pizza_7.png" type="image/png">
    <title>Área do Cliente</title>
</head>
<body>
    <h1 class="titulo">ÁREA DO CLIENTE</h1>
    <main>
        <section>
            <h1 class="nomecli">Olá {{ nome_usuario }} Bem-vindo(a) á sua página de pedidos!</h1>
            <div class="meus"><b>SEU ENDEREÇO</b></div>
            <div class="infocli">
                <p><strong>Endereço:</strong> {{ usuario.rua }}, nº {{ usuario.numero }}, CEP {{ usuario.cep }}, {{ usuario.ponto_referencia }}</p>
                <div class="botaoalterar">
                    <button class="botaoalterar"><b>ALTERAR</b></button>
                </div>
            </div>

            <!-- PEDIDOS EM PREPARO -->
<div class="container">
    <div class="meus"><b>PEDIDOS EM PREPARO</b></div>
    {% if pedidos_em_preparo %}
        {% for pedido in pedidos_em_preparo %}
            <div class="pedido">
                <p><b>Pedido ID:</b> {{ pedido.id_pedido }}</p>
                <p><b>Itens:</b></p>
                <ul>
                    {% for item in pedido.itens %}
                        <li>{{ item.sabor }} - {{ item.quantidade }}x - R$ {{ "%.2f"|format(item.preco_unitario) }}</li>
                    {% endfor %}
                </ul>
                <p><b>Total:</b> R$ {{ "%.2f"|format(pedido.total) }}</p>
                {% if pedido.cupom %}
                    <p><b>Cupom aplicado:</b> {{ pedido.cupom }}</p>
                    <p><b>Desconto:</b> R$ {{ "%.2f"|format(pedido.desconto) }}</p>
                {% endif %}
                <p><b>Valor final:</b> R$ {{ "%.2f"|format(pedido.valor_final) }}</p>

                <p><b>Status:</b> {{ pedido.status }}</p>
                <p><b>Data de entrega:</b> {{ pedido.data_entrega | datetimeformat }}</p>
                <form method="post" action="/cancelar-pedido/{{ pedido.id_pedido }}" onsubmit="return confirmarCancelamento(event)">
                    <button type="submit" class="botao-cancelar">CANCELAR PEDIDO</button>
                </form>
            </div>
        {% endfor %}
    {% else %}
        <p>Você não tem pedidos em preparo no momento.</p>
    {% endif %}
</div>

<!-- PEDIDOS ENTREGUES -->
<div class="container">
    <div class="meus"><b>PEDIDOS ENTREGUES</b></div>
    {% if pedidos_entregues %}
        {% for pedido in pedidos_entregues %}
            <div class="pedido">
                <p><b>Pedido ID:</b> {{ pedido.id_pedido }}</p>
                <p><b>Itens:</b></p>
                <ul>
                    {% for item in pedido.itens %}
                        <li>{{ item.sabor }} - {{ item.quantidade }}x - R$ {{ "%.2f"|format(item.preco_unitario) }}</li>
                    {% endfor %}
                </ul>
                <p><b>Total:</b> R$ {{ "%.2f"|format(pedido.total) }}</p>
                {% if pedido.cupom %}
                    <p><b>Cupom aplicado:</b> {{ pedido.cupom }}</p>
                    <p><b>Desconto:</b> R$ {{ "%.2f"|format(pedido.desconto) }}</p>
                {% endif %}
                <p><b>Valor final:</b> R$ {{ "%.2f"|format(pedido.valor_final) }}</p>

                <p><b>Status:</b> {{ pedido.status }}</p>
                <p><b>Data de entrega:</b> {{ pedido.data_entrega | datetimeformat }}</p>
            </div>
        {% endfor %}
    {% else %}
        <p>Você ainda não recebeu nenhum pedido.</p>
    {% endif %}
</div>

            <div class="container">
                <div class="meus"><b>MEUS CUPONS</b></div>
                <div class="pedido">
                    <p>conteúdo</p>
                    <div class="botaovermais">
                        <button class="botaovermais"><b>VER MAIS</b></button>
                    </div>            
                </div>
            </div>
        </section>
    </main>
    <script>
    function confirmarCancelamento(event) {
        event.preventDefault(); // Impede envio imediato

        if (confirm("Tem certeza que deseja cancelar o pedido?")) {
            event.target.submit(); // Envia se confirmar
        }

        return false; // Sempre bloqueia envio automático
    }
</script>

    <script src="/static/JS/nav.js"></script>
    <script src="/static/JS/footer.js"></script>
    <script src="/static/JS/btnTopo.js"></script>
</body>
</html>
