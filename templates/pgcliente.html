<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Área do cliente - Acompanhe seus pedidos e cupons">
    <link rel="stylesheet" href="/static/CSS/pedido.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link rel="icon" href="/static/img/pizza_7.png" type="image/png">
    <title>Área do Cliente - Meus Pedidos</title>
</head>
<body>
    <header role="banner">
        <h1 class="titulo">ÁREA DO CLIENTE</h1>
    </header>
    
    <main role="main">
        <article class="cliente-container">
            <section aria-labelledby="saudacaoUsuario"> 
                <h1 id="saudacaoUsuario" class="nomecli">Olá {{ nome_usuario }}! Bem-vindo(a) à sua página de pedidos!</h1>
                <div class="meus"><b>SEU ENDEREÇO</b></div>
                <div class="infocli" role="region" aria-label="Informações de endereço">
                    <p><strong>Endereço:</strong> {{ usuario.rua }}, nº {{ usuario.numero }}, CEP {{ usuario.cep }}, {{ usuario.ponto_referencia }}</p>
                    <div class="botaoalterar">
                        <button class="botaoalterar" aria-label="Alterar endereço de entrega"><b>ALTERAR</b></button>
                    </div>
                </div>
            </section>

            <!-- PEDIDOS EM PREPARO -->
            <section class="container" aria-labelledby="pedidosPreparoTitle">
                <h2 id="pedidosPreparoTitle" class="meus"><b>PEDIDOS EM PREPARO</b></h2>
                {% if pedidos_em_preparo %}
                    {% for pedido in pedidos_em_preparo %}
                        <article class="pedido" role="article" aria-labelledby="pedido{{ pedido.id_pedido }}"> 
                            <h3 id="pedido{{ pedido.id_pedido }}" class="sr-only">Pedido {{ pedido.id_pedido }}</h3>
                            
                            <dl> 
                                <dt><b>Pedido ID:</b></dt>
                                <dd>{{ pedido.id_pedido }}</dd>
                                
                                <dt><b>Itens:</b></dt>
                                <dd>
                                    <ul>
                                        {% for item in pedido.itens %}
                                            <li>{{ item.sabor }} - {{ item.tamanho }} - {{ item.quantidade }}x - R$ {{ "%.2f"|format(item.preco_unitario) }}</li>
                                        {% endfor %}
                                    </ul>
                                </dd>
                                
                                <dt><b>Total:</b></dt>
                                <dd>R$ {{ "%.2f"|format(pedido.total) }}</dd>
                                
                                {% if pedido.cupom %}
                                    <dt><b>Cupom aplicado:</b></dt>
                                    <dd>{{ pedido.cupom }}</dd>
                                    
                                    <dt><b>Desconto:</b></dt>
                                    <dd>R$ {{ "%.2f"|format(pedido.desconto) }}</dd>
                                {% endif %}
                                
                                <dt><b>Valor final:</b></dt>
                                <dd>R$ {{ "%.2f"|format(pedido.valor_final) }}</dd>
                                
                                <dt><b>Status:</b></dt>
                                <dd>{{ pedido.status }}</dd>
                                
                                <dt><b>Data de entrega:</b></dt>
                                <dd>{{ pedido.data_entrega | datetimeformat }}</dd>
                            </dl>

                            <form method="post" action="/cancelar-pedido/{{ pedido.id_pedido }}" onsubmit="return confirmarCancelamento(event)">
                                <button type="submit" class="botao-cancelar" aria-label="Cancelar pedido {{ pedido.id_pedido }}">CANCELAR PEDIDO</button>
                            </form>
                        </article>
                    {% endfor %}
                {% else %}
                    <p role="status">Você não tem pedidos em preparo no momento.</p>
                {% endif %}
            </section>

            <!-- PEDIDOS ENTREGUES -->
            <section class="container" aria-labelledby="pedidosEntreguesTitle">
                <h2 id="pedidosEntreguesTitle" class="meus"><b>PEDIDOS ENTREGUES</b></h2>
                {% if pedidos_entregues %}
                    {% for pedido in pedidos_entregues %}
                        <article class="pedido" role="article" aria-labelledby="pedidoEntregue{{ pedido.id_pedido }}">
                            <h3 id="pedidoEntregue{{ pedido.id_pedido }}" class="sr-only">Pedido entregue {{ pedido.id_pedido }}</h3>
                            
                            <dl>
                                <dt><b>Pedido ID:</b></dt>
                                <dd>{{ pedido.id_pedido }}</dd>
                                
                                <dt><b>Itens:</b></dt>
                                <dd>
                                    <ul>
                                        {% for item in pedido.itens %}
                                            <li>{{ item.sabor }} - {{ item.tamanho }} - {{ item.quantidade }}x - R$ {{ "%.2f"|format(item.preco_unitario) }}</li>
                                        {% endfor %}
                                    </ul>
                                </dd>
                                
                                <dt><b>Total:</b></dt>
                                <dd>R$ {{ "%.2f"|format(pedido.total) }}</dd>
                                
                                {% if pedido.cupom %}
                                    <dt><b>Cupom aplicado:</b></dt>
                                    <dd>{{ pedido.cupom }}</dd>
                                    
                                    <dt><b>Desconto:</b></dt>
                                    <dd>R$ {{ "%.2f"|format(pedido.desconto) }}</dd>
                                {% endif %}
                                
                                <dt><b>Valor final:</b></dt>
                                <dd>R$ {{ "%.2f"|format(pedido.valor_final) }}</dd>
                                
                                <dt><b>Status:</b></dt>
                                <dd>{{ pedido.status }}</dd>
                                
                                <dt><b>Data de entrega:</b></dt>
                                <dd>{{ pedido.data_entrega | datetimeformat }}</dd>
                            </dl>
                        </article>
                    {% endfor %}
                {% else %}
                    <p role="status">Você ainda não recebeu nenhum pedido.</p>
                {% endif %}
            </section>
        </article>
    </main>

    <script>
        function confirmarCancelamento(event) {
            event.preventDefault();
            
            if (confirm("Tem certeza que deseja cancelar o pedido?")) {
                event.target.submit();
            }
            
            return false;
        }
    </script>

    <script src="/static/JS/nav.js"></script>
    <script src="/static/JS/footer.js"></script>
    <script src="/static/JS/btnTopo.js"></script>
</body>
</html>